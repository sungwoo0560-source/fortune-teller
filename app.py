import streamlit as st
import random
from datetime import datetime
from korean_lunar_calendar import KoreanLunarCalendar

# ============================================================================
# [1] ì‹œìŠ¤í…œ ì„¤ì •
# ============================================================================
st.set_page_config(layout="wide", page_title="ì²œê¸°ëˆ„ì„¤ ì •ë°€ì ì‚¬", initial_sidebar_state="expanded")

# í°íŠ¸ ë° ë””ìì¸ ì„¤ì •
st.markdown("""
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap');
    * {font-family: 'Nanum Myeongjo', serif !important; line-height: 2.0 !important; font-size: 18px !important;}
    h1 {font-size: 32px !important; font-weight: 800; color: #111;}
    h2 {font-size: 26px !important; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-top: 40px; color: #333;}
    h3 {font-size: 22px !important; color: #555; margin-top: 20px;}
    .stAlert {background-color: #fff8f8; border: 1px solid #ffcdd2;}
    </style>
""", unsafe_allow_html=True)

# ============================================================================
# [2] ë°ì´í„°ë² ì´ìŠ¤
# ============================================================================
TOPICS = [
    "ğŸ”® ì¢…í•©/í‰ìƒ ì´ìš´", "ğŸŒ… 2026ë…„ ì‹ ë…„ ìš´ì„¸", "ğŸ’° ê¸ˆì „/ì¬ë¬¼/íš¡ì¬ìš´", "ğŸ¢ ì§ì¥/ìŠ¹ì§„/ëª…ì˜ˆìš´",
    "ğŸ‘” ì´ì§/ë³€ë™/ì´ë™ìˆ˜", "ğŸ’¼ ì‚¬ì—…/ì°½ì—…/íˆ¬ììš´", "â¤ï¸ ì§ì‚¬ë‘/ì¸/ì—°ì• ìš´", "ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ê¶í•©/ì• ì •/ê¶Œíƒœê¸°",
    "ğŸ’ ê²°í˜¼/ì¬í˜¼/ë°°ìš°ìë³µ", "ğŸ‘¶ ìë…€/ì„ì‹ /ì¶œì‚°ìš´", "ğŸ“ í•™ì—…/ì‹œí—˜/í•©ê²©ìš´", "ğŸ¥ ê±´ê°•/ì§ˆë³‘/ì‚¬ê³ ìˆ˜",
    "âœˆï¸ ì´ì‚¬/ì—¬í–‰/ìœ í•™ìš´", "ğŸ˜ï¸ ë¶€ë™ì‚°/ë§¤ë§¤/ë¬¸ì„œìš´", "âš–ï¸ ê´€ì¬/ì†Œì†¡/ë²•ì ë¬¸ì œ", "ğŸ¤¬ êµ¬ì„¤/ì‹œë¹„/ì¸ê°„ê´€ê³„",
    "ğŸ§¿ ì‚¼ì¬(ä¸‰ç½) í’€ì´", "ğŸ›¡ï¸ ì•¡ë§‰ì´/ì‚´í’€ì´/ê°œìš´", "ğŸ‘» ì‹ ë¼/ì˜ì ê¸°ìš´/ì¡°ìƒ", "ğŸ§˜ ì „ìƒì²´í—˜/ì¹´ë¥´ë§ˆ", "ğŸ€ ë¡œë˜/ë³µê¶Œ/ë‹¹ì²¨ìš´"
]
STEMS = {'ê°‘':'ç”²','ì„':'ä¹™','ë³‘':'ä¸™','ì •':'ä¸','ë¬´':'æˆŠ','ê¸°':'å·±','ê²½':'åºš','ì‹ ':'è¾›','ì„':'å£¬','ê³„':'ç™¸'}
BRANCHES = {'ì':'å­','ì¶•':'ä¸‘','ì¸':'å¯…','ë¬˜':'å¯','ì§„':'è¾°','ì‚¬':'å·³','ì˜¤':'åˆ','ë¯¸':'æœª','ì‹ ':'ç”³','ìœ ':'é…‰','ìˆ ':'æˆŒ','í•´':'äº¥'}
Z_TIME = ["ìì‹œ(23:30~01:29)","ì¶•ì‹œ(01:30~03:29)","ì¸ì‹œ(03:30~05:29)","ë¬˜ì‹œ(05:30~07:29)","ì§„ì‹œ(07:30~09:29)","ì‚¬ì‹œ(09:30~11:29)","ì˜¤ì‹œ(11:30~13:29)","ë¯¸ì‹œ(13:30~15:29)","ì‹ ì‹œ(15:30~17:29)","ìœ ì‹œ(17:30~19:29)","ìˆ ì‹œ(19:30~21:29)","í•´ì‹œ(21:30~23:29)"]

# ============================================================================
# [3] ë¡œì§ ì—”ì§„ (ì‚¬ì£¼ ê³„ì‚°)
# ============================================================================
def calculate_saju(y, m, d, lunar, yundal, t_idx):
    try:
        cal = KoreanLunarCalendar()
        if lunar:
            if not cal.setLunarDate(y, m, d, yundal): return None, None, "ìŒë ¥ ë‚ ì§œ ì˜¤ë¥˜"
            solar = datetime(cal.solarYear, cal.solarMonth, cal.solarDay)
        else:
            try: solar = datetime(y, m, d)
            except: return None, None, "ì–‘ë ¥ ë‚ ì§œ ì˜¤ë¥˜"
            cal.setSolarDate(solar.year, solar.month, solar.day)
        
        raw = cal.getGapJaString().replace('ë…„','').replace('ì›”','').replace('ì¼','').split()
        pillars = []
        for p in raw:
            g = STEMS.get(p[0], "ç”²")
            j = BRANCHES.get(p[1], "å­")
            pillars.append(g+j)
        
        gan_list = "ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸"
        ji_list = "å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥"
        d_idx = gan_list.find(pillars[2][0])
        if d_idx == -1: d_idx = 0
        t_idx_calc = (d_idx % 5 * 2 + t_idx) % 10
        pillars.append(gan_list[t_idx_calc] + ji_list[t_idx])
        
        z_map = {'å­':'ì¥','ä¸‘':'ì†Œ','å¯…':'í˜¸ë‘ì´','å¯':'í† ë¼','è¾°':'ìš©','å·³':'ë±€','åˆ':'ë§','æœª':'ì–‘','ç”³':'ì›ìˆ­ì´','é…‰':'ë‹­','æˆŒ':'ê°œ','äº¥':'ë¼ì§€'}
        zodiac = z_map.get(pillars[0][1], 'ì•Œìˆ˜ì—†ìŒ')
        
        return solar, pillars, zodiac
    except Exception as e: return None, None, str(e)

# ============================================================================
# [4] ì‘ê°€ ì—”ì§„ (ë©˜íŠ¸ ì¤‘ë³µ ë°©ì§€ ì‹œìŠ¤í…œ íƒ‘ì¬)
# ============================================================================
def generate_long_text(name, pillars, zodiac, topic, solar_date):
    day_gan = pillars[2][0]
    
    # 1. ì„œë¡ 
    intro_text = f"""
    ì²œì§€ì‹ ëª…ê»˜ ê³ í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ ì¸ì—°ì´ ë‹¿ì€ **{name}** ë‹˜ì˜ ìš´ëª…ì„ í¼ì³ë³´ë‹ˆ, í•˜ëŠ˜ì˜ ë³„ë“¤ì´ ì†ì‚­ì´ëŠ” ì†Œë¦¬ê°€ ë“¤ë¦¬ëŠ”ë“¯í•©ë‹ˆë‹¤.
    ê·€í•˜ëŠ” **{day_gan}ì¼ê°„**ìœ¼ë¡œ íƒœì–´ë‚˜, ì˜¤í–‰ì˜ ê¸°ìš´ ì¤‘ ê°€ì¥ ì¤‘ì‹¬ì´ ë˜ëŠ” ê¸°ìš´ì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤.
    ì‚¬ì£¼íŒ”ìë€ ë°”ê¿€ ìˆ˜ ì—†ëŠ” ì„ ì²œì ì¸ ëª…(å‘½)ê³¼ ë…¸ë ¥ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆëŠ” ìš´(é‹)ì˜ ì¡°í•©ì…ë‹ˆë‹¤.
    
    ê·€í•˜ì˜ ì‚¬ì£¼ëŠ” ë§ˆì¹˜ ê±°ëŒ€í•œ ì‚°ë§¥ê³¼ë„ ê°™ìŠµë‹ˆë‹¤. ë•Œë¡œëŠ” ë¹„ë°”ëŒì´ ëª°ì•„ì¹˜ê³ , ë•Œë¡œëŠ” ë”°ìŠ¤í•œ í–‡ë³•ì´ ë‚´ë¦¬ì¬ì§€ë§Œ, ì‚°ì€ ê·¸ ìë¦¬ì—ì„œ ë¬µë¬µíˆ ëª¨ë“  ê²ƒì„ ê²¬ëŒëƒ…ë‹ˆë‹¤.
    ì´ˆë…„ì˜ ê³ ìƒì€ ì´ ê±°ëŒ€í•œ ì‚°ì„ ìŒ“ê¸° ìœ„í•œ í™ê³¼ ëŒì´ì—ˆìœ¼ë©°, ì´ì œ ê·¸ ì‚° ìœ„ì—ì„œ ì„¸ìƒì„ í˜¸ë ¹í•  ì¤€ë¹„ê°€ ë˜ì–´ê°€ê³  ìˆìŠµë‹ˆë‹¤.
    
    íŠ¹íˆ **{zodiac}ë **ì˜ ê¸°ì§ˆì„ ê°€ì§€ê³  ìˆì–´, ëª©í‘œë¥¼ í–¥í•´ ëŒì§„í•˜ëŠ” ì¶”ì§„ë ¥ê³¼ í•œë²ˆ ë¬¼ë©´ ë†“ì§€ ì•ŠëŠ” ëˆê¸°ê°€ ëŒ€ë‹¨í•©ë‹ˆë‹¤.
    ì´ ë³´ê³ ì„œì—ì„œëŠ” ê·€í•˜ê°€ ì•ìœ¼ë¡œì˜ 10ë…„, 20ë…„ì„ ì–´ë–»ê²Œ ì‚´ì•„ê°€ì•¼ í• ì§€ ìƒì„¸í•˜ê²Œ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
    """

    # 2. ì„±ê²© ë¶„ì„
    personality_text = f"""
    ê·€í•˜ì˜ ë‚´ë©´ì„ ê¹Šì´ ë“¤ì—¬ë‹¤ë³´ë©´, ê²‰ìœ¼ë¡œëŠ” ìœ ìˆœí•˜ê³  ë¶€ë“œëŸ¬ì›Œ ë³´ì´ì§€ë§Œ ë‚´ë©´ì—ëŠ” ê°•ì²  ê°™ì€ ì‹¬ì§€ê°€ ìë¦¬ ì¡ê³  ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ 'ì™¸ìœ ë‚´ê°•'ì´ë¼ í•©ë‹ˆë‹¤.
    ë‚¨ë“¤ì—ê²Œ ì‹«ì€ ì†Œë¦¬ í•˜ê¸°ë¥¼ êº¼ë¦¬ê³ , ì›¬ë§Œí•˜ë©´ ì–‘ë³´í•˜ë ¤ í•˜ì§€ë§Œ, ë³¸ì¸ì˜ ìì¡´ì‹¬ì„ ê±´ë“œë¦¬ëŠ” ë¬¸ì œì— ëŒ€í•´ì„œëŠ” ì ˆëŒ€ íƒ€í˜‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    
    **ì²«ì§¸, ì§ê´€ë ¥ê³¼ í†µì°°ë ¥ì…ë‹ˆë‹¤.**
    ê·€í•˜ëŠ” ë‚¨ë“¤ì´ ë³´ì§€ ëª»í•˜ëŠ” ì´ë©´ì„ ê¿°ëš«ì–´ ë³´ëŠ” ëˆˆì„ ê°€ì¡ŒìŠµë‹ˆë‹¤. ì‚¬ëŒì„ ì²˜ìŒ ë§Œë‚¬ì„ ë•Œ ëŠê»´ì§€ëŠ” ì²«ì¸ìƒì´ ê±°ì˜ ë§ì•„ë–¨ì–´ì§€ëŠ” ê²½ìš°ê°€ ë§ì•˜ì„ ê²ƒì…ë‹ˆë‹¤.
    
    **ë‘˜ì§¸, ê³ ë…ê³¼ ì±…ì„ê°ì…ë‹ˆë‹¤.**
    ì£¼ë³€ì— ì‚¬ëŒì€ ë§ìœ¼ë‚˜, ì •ì‘ ê·€í•˜ì˜ ê¹Šì€ ì†ë§ˆìŒì„ í„¸ì–´ë†“ì„ ì‚¬ëŒì€ ê·¸ë¦¬ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. 'êµ°ì¤‘ ì†ì˜ ê³ ë…'ì´ë¼ëŠ” ë§ì´ ë”± ì–´ìš¸ë¦½ë‹ˆë‹¤.
    
    **ì…‹ì§¸, ì¬ë¬¼ì— ëŒ€í•œ ê°ê°ì…ë‹ˆë‹¤.**
    ê·€í•˜ëŠ” í˜„ì‹¤ì ì¸ ê°ê°ì´ ë›°ì–´ë‚˜ ëˆì˜ íë¦„ì„ ì˜ ì½ìŠµë‹ˆë‹¤. í—ˆí™©ëœ ê¿ˆì„ ì«“ê¸°ë³´ë‹¤ëŠ” ì‹¤ì§ˆì ì¸ ì´ë“ì„ ì¤‘ìš”ì‹œí•©ë‹ˆë‹¤.
    """

    # 3. ìƒì„¸ ë¶„ì„
    detail_text = ""
    if "ì¬ë¬¼" in topic:
        detail_text = """
        ì¬ë¬¼ìš´ì„ ë…¼í•˜ê¸°ì— ì•ì„œ, ê·€í•˜ì˜ ì‚¬ì£¼ì— ìˆëŠ” 'ì¬ê³ (ì¬ë¬¼ ì°½ê³ )'ì˜ ìƒíƒœë¥¼ ì ê²€í•´ì•¼ í•©ë‹ˆë‹¤.
        ê·€í•˜ëŠ” í‰ìƒ êµ¶ì–´ ì£½ì„ íŒ”ìëŠ” ì•„ë‹™ë‹ˆë‹¤. í•˜ëŠ˜ì´ ë‚´ë¦° ì‹ë³µê³¼ ì¬ë³µì´ ê¸°ë³¸ì ìœ¼ë¡œ ê¹”ë ¤ ìˆìŠµë‹ˆë‹¤.
        í•˜ì§€ë§Œ ê·¸ë™ì•ˆì€ 'ë°‘ ë¹ ì§„ ë…ì— ë¬¼ ë¶“ê¸°' í˜•êµ­ì´ì—ˆìŠµë‹ˆë‹¤. ì—´ì‹¬íˆ ë²Œì–´ë‹¤ ì±„ì›Œ ë„£ìœ¼ë©´, ì–´ë””ì„ ê°€ êµ¬ë©ì´ ë‚˜ ì¤„ì¤„ ìƒˆì–´ ë‚˜ê°€ëŠ” ì¼ì´ ë°˜ë³µë˜ì—ˆì„ ê²ƒì…ë‹ˆë‹¤.
        
        **í˜„ì¬ì™€ ë¯¸ë˜ì˜ íë¦„:**
        ê·¸ëŸ¬ë‚˜ ì´ì œ ë°”ëŒì˜ ë°©í–¥ì´ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤. ë§‰í˜€ìˆë˜ ìˆ˜ë¡œê°€ ëš«ë¦¬ë“¯ ì¬ë¬¼ìš´ì´ ìœ ì…ë˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤.
        íŠ¹íˆ 'ì •ì¬(ê³ ì •ìˆ˜ì…)'ì™€ 'í¸ì¬(ì‚¬ì—…ìˆ˜ìµ/íˆ¬ììˆ˜ìµ)'ê°€ í•¨ê»˜ ë“¤ì–´ì˜¤ëŠ” í˜•êµ­ì´ë¼, ì§ì¥ì¸ì€ ìŠ¹ì§„ì´ë‚˜ ì—°ë´‰ ì¸ìƒì´ ê¸°ëŒ€ë˜ê³ , ì‚¬ì—…ê°€ëŠ” ë§¤ì¶œ ì¦ëŒ€ê°€ ì˜ˆìƒë©ë‹ˆë‹¤.
        """
    else:
        detail_text = """
        ê·€í•˜ê°€ ì„ íƒí•˜ì‹  ì£¼ì œì— ëŒ€í•œ ìš´ì„¸ëŠ” ì§€ê¸ˆ ì¸ìƒì˜ ëŒ€ì „í™˜ê¸°ì— ì™€ ìˆìŒì„ ì‹œì‚¬í•©ë‹ˆë‹¤.
        ì§€ê¸ˆê¹Œì§€ì˜ ì‚¶ì´ 'ì¤€ë¹„ ë‹¨ê³„'ì˜€ë‹¤ë©´, ì´ì œë¶€í„°ëŠ” 'ì‹¤ì „'ì…ë‹ˆë‹¤.
        ìš´ì„¸ì˜ ê·¸ë˜í”„ê°€ ë°”ë‹¥ì„ ì¹˜ê³  ìš°ìƒí–¥ìœ¼ë¡œ ì†Ÿêµ¬ì¹˜ëŠ” ì´ˆì…ì— ì™€ ìˆìŠµë‹ˆë‹¤.
        
        **ë¯¸ë˜ ì „ë§:**
        ê·€ì¸ì„ ë§Œë‚  ìš´ì„¸ê°€ ê°•í•˜ê²Œ ë“¤ì–´ì™€ ìˆìŠµë‹ˆë‹¤. í‰ì†Œ ì•Œê³  ì§€ë‚´ë˜ ì„ ë°°ë‚˜ ì§€ì¸, í˜¹ì€ ì¼ì ìœ¼ë¡œ ë§Œë‚œ ì‚¬ëŒ ì¤‘ì— ê·€í•˜ì—ê²Œ ê²°ì •ì ì¸ ë„ì›€ì„ ì¤„ ì‚¬ëŒì´ ìˆìŠµë‹ˆë‹¤.
        ë˜í•œ, ì´ë™ìˆ˜(ì´ì§, ì´ì‚¬, ë¶€ì„œ ì´ë™)ê°€ ë³´ì…ë‹ˆë‹¤. ì´ëŠ” ê¸ì •ì ì¸ ì‹ í˜¸ì…ë‹ˆë‹¤. ê³ ì¸ ë¬¼ì€ ì©ê¸° ë§ˆë ¨ì´ë‹ˆ, ë³€í™”ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ë§ê³  ë°›ì•„ë“¤ì´ì‹­ì‹œì˜¤.
        """

    # -----------------------------------------------------------
    # [í•µì‹¬] ì›”ë³„ ë©˜íŠ¸ ì¤‘ë³µ ë°©ì§€ (Random Shuffle ì ìš©)
    # -----------------------------------------------------------
    
    # ì ìˆ˜ë³„ ë©˜íŠ¸ ì£¼ë¨¸ë‹ˆ (Pool)
    msgs_90 = [
        "í•˜ëŠ˜ì˜ ë¬¸ì´ ì—´ë¦¬ëŠ” ëŒ€ê¸¸ì˜ ë‹¬ì…ë‹ˆë‹¤. ì˜¤ë«ë™ì•ˆ ê¸°ë‹¤ë ¤ì˜¨ ì†Œì‹ì´ ë“¤ë ¤ì˜µë‹ˆë‹¤.",
        "ê·€ì¸ì´ ë™ìª½ì—ì„œ ë‚˜íƒ€ë‚˜ ë„ìš¸ ê²ƒì…ë‹ˆë‹¤. ëœ»ë°–ì˜ íš¡ì¬ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤.",
        "ë§‰í˜”ë˜ ìê¸ˆì¤„ì´ í™• íŠ¸ì´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì ê·¹ì ìœ¼ë¡œ íˆ¬ìë¥¼ ê³ ë ¤í•´ë³¼ ë§Œí•©ë‹ˆë‹¤.",
        "ê°€ì •ì— ê²½ì‚¬ê°€ ìƒê¸°ê±°ë‚˜ ë¬¸ì„œìš´ì´ í¬ê²Œ ë“¤ì–´ì˜µë‹ˆë‹¤. ë„ì¥ì„ ì°ê¸°ì— ì¢‹ì€ ë‹¬ì…ë‹ˆë‹¤.",
        "í•˜ëŠ” ì¼ë§ˆë‹¤ ìˆœí’ì— ë›ì„ ë‹¨ ë“¯ í’€ë ¤ë‚˜ê°‘ë‹ˆë‹¤. ìŠ¹ì§„ì´ë‚˜ í•©ê²©ì˜ ê¸°ìš´ì´ ê°•í•©ë‹ˆë‹¤."
    ]
    msgs_70 = [
        "ìˆœì¡°ë¡œìš´ íë¦„ì…ë‹ˆë‹¤. ë…¸ë ¥í•œ ë§Œí¼ ì •ì§í•œ ëŒ€ê°€ê°€ ë”°ë¥´ëŠ” ë‹¬ì…ë‹ˆë‹¤.",
        "ì£¼ë³€ ì‚¬ëŒë“¤ê³¼ì˜ ê´€ê³„ê°€ ëˆë…í•´ì§‘ë‹ˆë‹¤. ì‘ì€ ì´ìµì´ ê¾¸ì¤€íˆ ë“¤ì–´ì˜µë‹ˆë‹¤.",
        "í° ëŒ€ë°•ì€ ì—†ìœ¼ë‚˜ ê·¼ì‹¬ ê±±ì •ì´ ì—†ëŠ” í‰ì˜¨í•œ ë‹¬ì…ë‹ˆë‹¤. í˜„ìƒ ìœ ì§€ì— í˜ì“°ì‹­ì‹œì˜¤.",
        "ì§ì¥ì—ì„œ ëŠ¥ë ¥ì„ ì¸ì •ë°›ìŠµë‹ˆë‹¤. ì„±ì‹¤í•¨ì´ ìµœê³ ì˜ ë¬´ê¸°ê°€ ë©ë‹ˆë‹¤.",
        "ê±´ê°• ìƒíƒœê°€ ì–‘í˜¸í•˜ê³  ì»¨ë””ì…˜ì´ ì¢‹ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì·¨ë¯¸ë¥¼ ì‹œì‘í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤."
    ]
    msgs_50 = [
        "ëŒë‹¤ë¦¬ë„ ë‘ë“¤ê²¨ ë³´ê³  ê±´ë„ˆì•¼ í•©ë‹ˆë‹¤. ê²‰ì€ ì¢‹ì•„ ë³´ì´ë‚˜ ì‹¤ì†ì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        "ë¬´ë¦¬í•œ í™•ì¥ì€ ê¸ˆë¬¼ì…ë‹ˆë‹¤. ì§€ê¸ˆì€ ë‚´ì‹¤ì„ ë‹¤ì§€ë©° ë•Œë¥¼ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.",
        "ì§€ì¶œì´ ëŠ˜ì–´ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶©ë™êµ¬ë§¤ë¥¼ ìì œí•˜ê³  ì§€ê°‘ì„ ë‹«ìœ¼ì‹­ì‹œì˜¤.",
        "ì—…ë¬´ëŸ‰ì´ ëŠ˜ì–´ë‚˜ í”¼ë¡œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê±´ê°• ê´€ë¦¬ì— ê°ë³„íˆ ìœ ì˜í•˜ì‹­ì‹œì˜¤.",
        "ë³€ë™ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ì´ì‚¬ë‚˜ ì´ë™ì„ ê³„íší•œë‹¤ë©´ ì‹ ì¤‘í•˜ê²Œ ê²€í† í•˜ì‹­ì‹œì˜¤."
    ]
    msgs_bad = [
        "êµ¬ì„¤ìˆ˜ê°€ ë”°ë¦…ë‹ˆë‹¤. ë‚¨ì˜ ë§ì— ë¼ì–´ë“¤ì§€ ë§ê³  ì–¸í–‰ì„ ì¡°ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤.",
        "ë¯¿ì—ˆë˜ ì‚¬ëŒì—ê²Œ ì‹¤ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸ˆì „ ê±°ë˜ëŠ” ì ˆëŒ€ í•˜ì§€ ë§ˆì‹­ì‹œì˜¤.",
        "ê±´ê°•ì— ì ì‹ í˜¸ê°€ ì¼œì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ì€ ë³‘ì´ë¼ë„ í‚¤ìš°ì§€ ë§ê³  ë³‘ì›ì— ê°€ì‹­ì‹œì˜¤.",
        "ìƒê°ì§€ ëª»í•œ ë‚œê´€ì— ë¶€ë”ªí ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œ ì‰¬ì–´ê°€ëŠ” ì§€í˜œê°€ í•„ìš”í•©ë‹ˆë‹¤.",
        "ìš´ê¸°ê°€ ë‹¤ì†Œ í•˜ë½ì„¸ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì¼ì„ ë²Œì´ê¸°ë³´ë‹¤ëŠ” ìˆ˜ì„±ì— í˜ì“°ì‹­ì‹œì˜¤."
    ]

    # ë©˜íŠ¸ ì„ê¸° (Shuffle)
    random.shuffle(msgs_90)
    random.shuffle(msgs_70)
    random.shuffle(msgs_50)
    random.shuffle(msgs_bad)

    monthly_data = []
    
    # ë©˜íŠ¸ ë½‘ì•„ë‚´ê¸°
    for i in range(1, 13):
        score = random.randint(40, 100)
        
        if score >= 90:
            ment = msgs_90.pop() if msgs_90 else "ëŒ€ìš´ì´ ë“¤ì–´ì™€ ë§Œì‚¬í˜•í†µí•©ë‹ˆë‹¤." # ë‹¤ ì“°ë©´ ê¸°ë³¸ë©˜íŠ¸
        elif score >= 70:
            ment = msgs_70.pop() if msgs_70 else "í‰ì˜¨í•˜ê³  ì•ˆì •ì ì¸ ë‹¬ì…ë‹ˆë‹¤."
        elif score >= 50:
            ment = msgs_50.pop() if msgs_50 else "ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì „ì§„í•´ì•¼ í•  ì‹œê¸°ì…ë‹ˆë‹¤."
        else:
            ment = msgs_bad.pop() if msgs_bad else "ë§¤ì‚¬ ì‹ ì¤‘í•˜ê³  ê±´ê°•ì„ ì±™ê¸°ì‹­ì‹œì˜¤."
            
        monthly_data.append(f"**{i}ì›” (ìš´ì„¸ {score}ì ):** {ment}")

    # 5. ëŒ€ìš´ ë¶„ì„
    daewoon_data = []
    start_age = random.randint(1, 9)
    for i in range(8):
        age = start_age + (i * 10)
        # ë‚˜ì´ëŒ€ì— ë§ëŠ” ì„¤ëª… (ê³ ì •)
        if i == 0: desc = "í•™ì—…ì— ì—´ì¤‘í•˜ë©° ë¶€ëª¨ì˜ ê·¸ëŠ˜ ì•„ë˜ì„œ ìì•„ë¥¼ í˜•ì„±í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
        elif i == 1: desc = "ì§ˆí’ë…¸ë„ì˜ ì‹œê¸°ì´ì ì‚¬íšŒë¡œ ë‚˜ì•„ê°€ê¸° ìœ„í•œ ì¤€ë¹„ ë‹¨ê³„ì…ë‹ˆë‹¤."
        elif i == 2: desc = "ì‚¬íšŒ ì´ˆë…„ìƒìœ¼ë¡œì„œ ì¹˜ì—´í•œ ê²½ìŸì„ ê²½í—˜í•˜ë©° ìë¦¬ë¥¼ ì¡ìŠµë‹ˆë‹¤."
        elif i == 3: desc = "ì¸ìƒì˜ ê¸°ë°˜ì„ ë‹¦ê³  ê°€ì •ì„ ê¾¸ë¦¬ê±°ë‚˜ ì»¤ë¦¬ì–´ì˜ ì •ì ì„ í–¥í•´ ë‹¬ë¦½ë‹ˆë‹¤."
        elif i == 4: desc = "ì‚¬íšŒì  ì§€ìœ„ê°€ ì•ˆì •ë˜ê³  ì¬ë¬¼ì´ ëª¨ì´ê¸° ì‹œì‘í•˜ëŠ” ê²°ì‹¤ì˜ ê³„ì ˆì…ë‹ˆë‹¤."
        elif i == 5: desc = "ì¸ìƒì˜ ì œ2ë§‰ì„ ì¤€ë¹„í•˜ë©°, ëª…ì˜ˆì™€ ì•ˆì •ì„ ë™ì‹œì— ì¶”êµ¬í•©ë‹ˆë‹¤."
        elif i == 6: desc = "ëª¨ë“  ì§ì„ ë‚´ë ¤ë†“ê³  ë§ˆìŒì˜ ì—¬ìœ ë¥¼ ì°¾ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
        else: desc = "ì¸ìƒì„ ê´€ì¡°í•˜ë©° í‰ì˜¨í•œ ë…¸í›„ë¥¼ ë³´ë‚´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
        
        daewoon_data.append(f"**{age}~{age+9}ì„¸ ëŒ€ìš´:** {desc}")

    return intro_text, personality_text, detail_text, monthly_data, daewoon_data

# ============================================================================
# [5] ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜
# ============================================================================
def main():
    with st.sidebar:
        st.title("â›©ï¸ ì²œê¸°ëˆ„ì„¤ ëŒ€ë§Œì‹ ")
        with st.form("input_form"):
            name = st.text_input("ì´ë¦„", "ë°•ì„±ìš°")
            c1, c2, c3 = st.columns([1.2, 1, 1])
            y = c1.number_input("ìƒë…„", 1930, 2026, 1969)
            m = c2.selectbox("ì›”", range(1, 13))
            d = c3.selectbox("ì¼", range(1, 32))
            chk = st.columns(2)
            lunar = chk[0].checkbox("ìŒë ¥")
            yundal = chk[1].checkbox("ìœ¤ë‹¬")
            t_str = st.selectbox("íƒœì–´ë‚œ ì‹œ", Z_TIME)
            topic = st.selectbox("ìƒë‹´ ì£¼ì œ", TOPICS)
            submit = st.form_submit_button("ğŸ”¥ ì •ë°€ ë³´ê³ ì„œ ìƒì„±", type="primary")

    if submit:
        t_idx = Z_TIME.index(t_str)
        s_date, pillars, zodiac = calculate_saju(y, m, d, lunar, yundal, t_idx)
        
        if s_date is None:
            st.error(f"ë‚ ì§œ ì˜¤ë¥˜: {zodiac}")
        else:
            intro, prop, detail, monthly, daewoon = generate_long_text(name, pillars, zodiac, topic, s_date)
            
            # ë³´ê³ ì„œ ì¶œë ¥
            st.title(f"ğŸ“œ {name} ë‹˜ì˜ ìš´ëª… ì •ë°€ ë³´ê³ ì„œ")
            st.caption(f"ì–‘ë ¥ìƒì¼: {s_date.strftime('%Y-%m-%d')} | ë : {zodiac}")
            st.divider()

            st.header("1. ì²œê¸°ëˆ„ì„¤(å¤©æ©Ÿæ¼æ´©): ìš´ëª…ì˜ ì„œë§‰")
            st.markdown(intro)
            st.markdown("<br>", unsafe_allow_html=True)

            st.header("2. ì‚¬ì£¼íŒ”ì(å››æŸ±å…«å­—) ëª…ì‹ ë¶„ì„")
            c1, c2, c3, c4 = st.columns(4)
            titles = ["ë…„ì£¼(ì¡°ìƒê¶)", "ì›”ì£¼(ë¶€ëª¨ê¶)", "ì¼ì£¼(ë³¸ì¸ê¶)", "ì‹œì£¼(ìì‹ê¶)"]
            for i in range(4):
                with [c1,c2,c3,c4][i].container(border=True):
                    st.subheader(titles[i])
                    st.markdown(f"### {pillars[i]}")
            st.markdown("<br>", unsafe_allow_html=True)

            st.header("3. ì‹¬ì¸µ ì„±ê²© ë° ë‚´ë©´ ë¶„ì„")
            st.markdown(prop)
            st.markdown("<br>", unsafe_allow_html=True)

            st.header(f"4. {topic} ì •ë°€ ì§„ë‹¨")
            st.markdown(detail)
            st.warning("âš¡ **[ì‹ ë ¹ë‹˜ì˜ íŠ¹ë³„ ë¹„ë°©]** ì§€ê°‘ì— 5ë§Œì›ê¶Œì„ ì§ìˆ˜ë¡œ ì†Œì§€í•˜ì‹œê³ , ì¤‘ìš”í•œ ê³„ì•½ì€ ì˜¤ì „ì— ì§„í–‰í•˜ì‹­ì‹œì˜¤.")
            st.markdown("<br>", unsafe_allow_html=True)

            st.header("5. 2026ë…„ ì›”ë³„ ìƒì„¸ íë¦„")
            # ì›”ë³„ ìš´ì„¸ë¥¼ 2ë‹¨ ê·¸ë¦¬ë“œë¡œ ë³´ì—¬ì£¼ê¸°
            m_col1, m_col2 = st.columns(2)
            for idx, m_data in enumerate(monthly):
                with (m_col1 if idx % 2 == 0 else m_col2).container(border=True):
                    st.markdown(m_data)
            st.markdown("<br>", unsafe_allow_html=True)

            st.header("6. í‰ìƒ ëŒ€ìš´(å¤§é‹)ì˜ íë¦„")
            for d_data in daewoon:
                with st.container(border=True):
                    st.markdown(d_data)
            
            st.divider()
            st.success("ë³¸ ë³´ê³ ì„œëŠ” ì²œê¸°ëˆ„ì„¤ ëŒ€ë§Œì‹ ì˜ ì˜ì  ì•Œê³ ë¦¬ì¦˜ì— ì˜í•´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê·€í•˜ì˜ ì•ë‚ ì— ê´‘ì˜ì´ í•¨ê»˜í•˜ê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.")

if __name__ == "__main__":
    main()